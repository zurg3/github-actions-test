name: GitHub-Actions-Test-Manual-Trigger

on:
  workflow_dispatch:
    inputs:
      notepad_release:
        description: "Notepad release"
        required: true
      qt_version:
        description: "Qt version"
        required: true

jobs:
  test_job:
    runs-on: ubuntu-latest
    steps:
      - name: Print message
        run: echo "Hello, World!"

  notepad:
    runs-on: windows-latest
    steps:
      - name: Git Clone
        uses: actions/checkout@v2
        with:
          repository: zurg3/notepad
          path: notepad
          ref: ${{ github.event.inputs.notepad_release }}

      - name: Setup Qt5
        uses: jurplel/install-qt-action@v2
        with:
          version: ${{ github.event.inputs.qt_version }}
          host: "windows"
          target: "desktop"
          install-deps: "true"
          mirror: "http://mirrors.ocf.berkeley.edu/qt/"
          cached: "false"

      - name: Setup MSBuild
        uses: microsoft/setup-msbuild@v1

      - name: Build
        run: |
          mkdir build
          cd build
          cmake ..
          cmake --build . --config Release
          windeployqt --no-translations Release
      - name: Upload artifact
        uses: actions/upload-artifact@v1
        with:
          name: notepad-${{ github.event.inputs.notepad_release }}-win32-x64
          path: build\Release
